<h1>Projeto¬†Blog¬†Pessoal¬†- Componente AuthContext</h1>



Com a Estiliza√ß√£o do Componente **Login** conclu√≠da, vamos implementar a l√≥gica do Componente, que ser√° respons√°vel por consumir o Login do Recurso Usuario do nosso Backend.

O Componente ir√° consumir o M√©todo **Login do Usu√°rio ( autenticar() )** do Backend do Blog Pessoal, cuja a fun√ß√£o √© autorizar o acesso do usu√°rio na aplica√ß√£o.

Vamos come√ßar criando o Componente **AuthContext**, que ser√° respons√°vel por criar o contexto da nossa aplica√ß√£o, al√©m de compartilhar os dados do usu√°rio autenticado com toda a aplica√ß√£o:

<br />

<h2>üë£ Passo 01 - Criar a pasta Contexts</h2>



Antes de criarmos o Componente **AuthContext**, vamos criar a pasta **contexts**:

1. Na pasta **src**, clique com o bot√£o direito do mouse e clique na op√ß√£o **New Folder** (Nova Pasta).
2. O nome da pasta ser√° **contexts**. Ap√≥s digitar o nome da pasta, pressione a tecla **enter** do seu teclado para concluir.
3. Ao concluir, voc√™ deve estar a seguinte estrutura dentro da pasta **src**:

<div align="center"><img src="https://i.imgur.com/jE2axX7.png" title="source: imgur.com" /></div>

<br>

<h2><img src="https://i.imgur.com/H9wEgsJ.png" title="source: imgur.com" width="4%"/>Passo 02 - Criar o Componente AuthContext</h2>



Vamos criar o Componente **AuthContext**, dentro da pasta **contexts**:

1. Na pasta **contexts**, clique com o bot√£o direito do mouse e clique na op√ß√£o **New File** (Novo Arquivo).
2. O nome do arquivo ser√° **AuthContext.tsx**. Ap√≥s digitar o nome do arquivo, pressione a tecla **enter** do seu teclado para concluir.
3. Na sequ√™ncia, adicione o c√≥digo abaixo no Componente **AuthContext**:

```tsx
import { createContext, ReactNode, useState } from "react"

import UsuarioLogin from "../models/UsuarioLogin"
import { login } from "../services/Service"

interface AuthContextProps {
    usuario: UsuarioLogin
    handleLogout(): void
    handleLogin(usuario: UsuarioLogin): Promise<void>
    isLoading: boolean
}

interface AuthProviderProps {
    children: ReactNode
}

export const AuthContext = createContext({} as AuthContextProps)

export function AuthProvider({ children }: AuthProviderProps) {

    const [usuario, setUsuario] = useState<UsuarioLogin>({
        id: 0,
        nome: "",
        usuario: "",
        senha: "",
        foto: "",
        token: ""
    })

    const [isLoading, setIsLoading] = useState(false)

    async function handleLogin(usuarioLogin: UsuarioLogin) {
        setIsLoading(true)
        try {
            await login(`/usuarios/logar`, usuarioLogin, setUsuario)
            alert("O Usu√°rio foi autenticado com sucesso!")
        } catch (error) {
            alert("Os Dados do usu√°rio est√£o inconsistentes!")
        }
        setIsLoading(false)
    }

    function handleLogout() {
        setUsuario({
            id: 0,
            nome: "",
            usuario: "",
            senha: "",
            foto: "",
            token: ""
        })
    }

    return (
        <AuthContext.Provider value={{ usuario, handleLogin, handleLogout, isLoading }}>
            {children}
        </AuthContext.Provider>
    )
}
```

**Vamos analisar o nosso c√≥digo:**

<div align="center"><img src="https://i.imgur.com/gWGbp5U.png" title="source: imgur.com" /></div>

**Linha 01:** Importamos os m√≥dulos e fun√ß√µes necess√°rias do React:

- **ReactNode**: nada mais √© que uma **tipagem especial do React**, que **representa qualquer elemento que pode ser renderizado** como um elemento na √°rvore de componentes do React;
- **createContext**: √© a **fun√ß√£o do React que permite criarmos o contexto**, a "√°rea de armazenamento" compartilhada que pode ser acessada por diferentes componentes. **Sem essa fun√ß√£o, n√£o h√° como criarmos o Contexto**;
- **useState**: √© o hook que permite criarmos uma vari√°vel de estado em nossa aplica√ß√£o;

**Linhas 03 e 04:** Importamos a **model de UsuarioLogin e a Service Login.**

**Linha 05 a 10:** Criamos a Interface **AuthContextProps** com as propriedades que ser√£o compartilhadas com toda a aplica√ß√£o. Lembrando que essa interface tem como responsabilidade definir a estrutura do nosso contexto, ou seja, **quais Estados e Fun√ß√µes ser√£o aramzenadas no contexto.** Note que ela possui quatro propriedades (Estados e Fun√ß√µes):

- **usuario**: Esta propriedade representa um objeto do tipo **UsuarioLogin**. Ela ir√° guardar os dados do usu√°rio autenticado.
- **handleLogout()**: Esta propriedade √© uma fun√ß√£o, que n√£o possui argumentos e n√£o retorna um valor (void). Ser√° utilizada para realizar o logout do usu√°rio, alterando o estado do usu√°rio autenticado para o seu estado original.
- **handleLogin(usuario: UsuarioLogin): Promise<void>:** Esta fun√ß√£o aceita um argumento chamado **usuario**, do tipo **UsuarioLogin** (Interface Model), que cont√©m as informa√ß√µes do login: **usuario** (e-mail) e **senha**. Depois de autenticar o usu√°rio, oa Backend retornar√° os demais atributos do usu√°rio (id, nome e foto), al√©m do **token**. O m√©todo **handleLogin()** retorna uma **Promise<void>**, o que indica que ele √© um M√©todo Ass√≠ncrono.
- **isLoading:** Propriedade do tipo **boolean**, usada para indicar se a aplica√ß√£o est√° carregando dados ou executando uma opera√ß√£o que leva algum tempo para receber uma resposta. Quando **isLoading** for **true**, esta propriedade ser√° usada para mostrar um Componente Loader, indicando que o usu√°rio deve aguardar o final do processo. O Componente Loader ser√° exibido dentro do bot√£o **Entrar**, da P√°gina de **Login**.

**Linhas 12 a 14:** Definimos a interface **AuthProviderProps**, que tem como responsabilidade definir a estrutura das propriedades do **Componente Provedor (Provider)**. Ele tem uma √∫nica propriedade, chamada **children**, que √© do tipo **ReactNode**, usado para encapsular e representar todos os componentes filhos da aplica√ß√£o (Componentes inseridos no Componente App e os seus subcomponentes), que ter√£o acesso ao contexto.

<div align="center"><img src="https://i.imgur.com/0XP4r8H.png" title="source: imgur.com" /></div>

**Linha 16:** Esta √© uma das linhas mais importantes da Context. **√â nesta linha que constru√≠mos e exportamos o contexto, indicando quais Estados e Fun√ß√µes estamos armazenando no Contexto**, em nosso projeto, ser√° a Interface **AuthContextProps**.

**Linhas 18 a 61:** Definimos e exportamos o Componente **AuthProvider**. O Componente **AuthProvider √© um  Componente Funcional, que tem como responsabilidades gerenciar o contexto da aplica√ß√£o, compartilhar o contexto, implementar as fun√ß√µes compartilhadas e atualizar os Estados compartilhados com toda a aplica√ß√£o**. 

Esse componente recebe como argumento a propriedade **children**, que √© usado para envolver e representar os todos os componentes filhos e seu subcomponentes, que ter√£o acesso aos Estados e Fun√ß√µes mantidos na Context.

**Linhas 20 a 27:** Definimos um estado, chamado **usuario**, com a sua respectiva fun√ß√£o de atualiza√ß√£o do estado, chamada **setUsuario**, atrav√©s do **Hook useState**. A vari√°vel de estado **usuario** ser√° utilizada para armazenar as informa√ß√µes do usu√°rio autenticado, ap√≥s o mesmo efetuar o login na aplica√ß√£o. Ela tamb√©m permitir√° que as informa√ß√µes do usu√°rio autenticado, sejam acessadas pelos demais componentes. Note que ela foi inicializada com todos os seus atributos vazios, de acordo com os respectivos tipos, indicando que n√£o tem nenhum usu√°rio autenticado.

* A estrutura **useState<UsuarioLogin>({ ... })** inicializa o estado **usuario** com um objeto que segue a estrutura da model **UsuarioLogin**. A nota√ß√£o, `<UsuarioLogin>` √© uma nota√ß√£o gen√©rica (Generic) que informa ao TypeScript o tipo de dado que useState deve esperar para o estado **usuario**. Isso ajuda a garantir que o estado seja sempre um objeto com as propriedades corretas.

<div align="center"><img src="https://i.imgur.com/a8zcMon.png" title="source: imgur.com" /></div>

**Linha 29:** Definimos um estado chamado **isLoading**, do tipo boolean, atrav√©s do **Hook useState**, com o valor inicial **false**. Este estado ser√° usado para armazenar uma vari√°vel do tipo boolean, auxiliando no processo de confirma√ß√£o se uma determinada a√ß√£o foi finalizada (false) ou n√£o (true). Para atualizar o estado da vari√°vel **isLoading**, foi criada a fun√ß√£o **setIsLoading**.

**Linhas 31 a 43:** A fun√ß√£o **handleLogin()** √© respons√°vel por realizar o processo de login do usu√°rio na aplica√ß√£o. Enquanto o processo de login est√° em andamento, a fun√ß√£o exibe um indicador de carregamento (Loader), trata os erros do processo, exibe alertas de sucesso ou falha do processo e atualiza o Estado da aplica√ß√£o, incluindo a atualiza√ß√£o dos dados do Estado usuario ap√≥s um login bem-sucedido.

- **async function handleLogin(userLogin: UsuarioLogin) { ... }**: Esta √© a fun√ß√£o ass√≠ncrona que recebe o argumento **userLogin**, objeto do tipo **UsuarioLogin** (Interface Model).
- **setIsLoading(true)**: Define o estado **isLoading** como **true**. Ela √© usada para controlar a exibi√ß√£o de um componente Loader, indicando que a aplica√ß√£o est√° aguardando a conclus√£o do processo de autentica√ß√£o.
- **try:** Adicionamos a estrutura de tratativa de erro **Try...Catch** para lidar com qualquer erro que possa acontecer no processo.
- **await login(`/usuarios/logar`, userLogin, setUsuario)**: Esta linha chama a fun√ß√£o **login** (Service), que consome o endpoint `/usuarios/logar`, do Recurso Usuario do Backend, respons√°vel por efetuar o login. Seguindo sua estrutura, passamos a URL da rota de login definida no Backend, os dados de login do usu√°rio atrav√©s do objeto **userLogin** e a fun√ß√£o **setUsuario** que √© usada para atualizar o estado do usu√°rio ap√≥s o login. A palavra-chave **await** indica que essa opera√ß√£o √© Ass√≠ncrona (retorna uma Promise), e a fun√ß√£o aguardar√° a conclus√£o da opera√ß√£o, antes de continuar o fluxo natural.
- **alert("Usu√°rio logado com sucesso")**: Se o processo de login for bem-sucedido, este c√≥digo exibir√° um alerta na tela, informando que o usu√°rio foi autenticado com sucesso.
- **catch (error) { ... }**: A estrutura catch captura qualquer erro que possa ocorrer durante o processo de login, e al√©m disso, exibe tanto no console do navegador, quanto na tela do usu√°rio (alerta), que ocorreu algum erro no processo.
- **setIsLoading(false)**: Independentemente da falha do login, altera o estado **isLoading** para **false**, indicando que o processo de autentica√ß√£o foi conclu√≠do.

<div align="center"><img src="https://i.imgur.com/LtG0PXG.png" title="source: imgur.com" /></div>

**Linhas 45 a 54:** A fun√ß√£o **handleLogout()** √© utilizada para reiniciar o estado usuario, definindo todas as suas propriedades com os valores padr√£o. Isso √© comum em sistemas de autentica√ß√£o para garantir que os dados do usu√°rio n√£o permane√ßam acess√≠veis ap√≥s o logout, obrigando que um novo login seja efetuado para acessar o sistema novamente.

- **function handleLogout() { ... }**: Esta fun√ß√£o n√£o aceita nenhum argumento e √© utilizada para efetuar o logout do usu√°rio.
- **setUsuario({ ... }):** A fun√ß√£o **setUsuario** ser√° utilizada para reiniciar o estado do usu√°rio aos seus valores iniciais (de acordo com o tipo de dado).

**Linhas 56 a 60:** Renderiza o componente **AuthProvider** com o contexto definido. Ele fornece para a aplica√ß√£o, atrav√©s da propriedade **value**, todas as propriedades definidas na Interface **AuthContextProps**, que foram implementadas dentro da l√≥gica do componente e mantidas no contexto.

<br />

<h2><img src="https://i.imgur.com/H9wEgsJ.png" title="source: imgur.com" width="4%"/>Passo 03 - Atualizar o Componente App</h2>



1. Abra o Componente **App**, localizado dentro da pasta **src**.
2. fa√ßa as altera√ß√µes indicadas na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/VDdQwvp.png" title="source: imgur.com" /></div>

<br>

**Vamos analisar o nosso c√≥digo:**

**Linha 05:** Importamos o componente **AuthProvider**;

**Linhas 13 e 26:** Envolvemos todos os Componentes inseridos no Componente **App**, com o Componente **AuthProvider**. Desta forma, **todos os Componentes dentro dele, ter√£o acesso aos Estados e Fun√ß√µes guardados na context.**

Na sequ√™ncia, vamos adicionar a l√≥gica no Componente **Login**...

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="5%"/> <a href="https://github.com/rafaelq80/blogpessoal_react_2024/tree/10_Contexts" target="_blank"><b>C√≥digo fonte do projeto</b></a></div>

<br /><br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>
