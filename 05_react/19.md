<h1>Projeto¬†Blog¬†Pessoal¬†- P√°gina de Login - L√≥gica</h1>



Para finalizar a implementa√ß√£o da P√°gina de Login, vamos adicionar a l√≥gica necess√°ria no Componente **Login**:

<br />

> [!CAUTION]
>
> **N√£o esque√ßa de inicializar o deploy do Backend no Render. Caso tenha alguma d√∫vida, consulte o conte√∫do: *P√°gina de  Cadastro - L√≥gica*.**

<br />

<h2><img src="https://i.imgur.com/H9wEgsJ.png" title="source: imgur.com" width="4%"/>Passo 01 - Implementar a L√≥gica do Componente Login</h2>



1. Abra o componente **Login.tsx** localizado dentro da pasta **src/pages/login**.
2. Substitua o C√≥digo do Componente **Login** pelo c√≥digo abaixo:

```tsx
import { Link, useNavigate } from 'react-router-dom';
import './Login.css';
import { AuthContext } from '../../contexts/AuthContext';
import { ChangeEvent, useContext, useEffect, useState } from 'react';
import UsuarioLogin from '../../models/UsuarioLogin';
import { RotatingLines } from 'react-loader-spinner';

function Login() {

    const navigate = useNavigate();

    const { usuario, handleLogin, isLoading } = useContext(AuthContext)

    const [usuarioLogin, setUsuarioLogin] = useState<UsuarioLogin>(
        {} as UsuarioLogin
    )

    useEffect(() => {
        if (usuario.token !== "") {
            navigate('/home')
        }
    }, [usuario])

    function atualizarEstado(e: ChangeEvent<HTMLInputElement>) {
        setUsuarioLogin({
            ...usuarioLogin,
            [e.target.name]: e.target.value
        })
    }

    function login(e: ChangeEvent<HTMLFormElement>) {
        e.preventDefault()
        handleLogin(usuarioLogin)
    }

    return (
        <>
            <div className="grid grid-cols-1 lg:grid-cols-2 
                    h-screen place-items-center font-bold ">
                <form className="flex justify-center items-center flex-col w-1/2 gap-4"
                    onSubmit={login}>
                    <h2 className="text-slate-900 text-5xl ">Entrar</h2>
                    <div className="flex flex-col w-full">
                        <label htmlFor="usuario">Usu√°rio</label>
                        <input
                            type="text"
                            id="usuario"
                            name="usuario"
                            placeholder="Usuario"
                            className="border-2 border-slate-700 rounded p-2"
                            value={usuarioLogin.usuario}
                            onChange={(e: ChangeEvent<HTMLInputElement>) => atualizarEstado(e)}
                        />
                    </div>
                    <div className="flex flex-col w-full">
                        <label htmlFor="senha">Senha</label>
                        <input
                            type="password"
                            id="senha"
                            name="senha"
                            placeholder="Senha"
                            className="border-2 border-slate-700 rounded p-2"
                            value={usuarioLogin.senha}
                            onChange={(e: ChangeEvent<HTMLInputElement>) => atualizarEstado(e)}
                        />
                    </div>
                    <button
                        type='submit'
                        className="rounded bg-indigo-400 flex justify-center
                                   hover:bg-indigo-900 text-white w-1/2 py-2">
                                    
                        {isLoading ? <RotatingLines
                            strokeColor="white"
                            strokeWidth="5"
                            animationDuration="0.75"
                            width="24"
                            visible={true}
                        /> :
                            <span>Entrar</span>
                        }
                    </button>

                    <hr className="border-slate-800 w-full" />

                    <p>
                        Ainda n√£o tem uma conta?{' '}
                        <Link to="/cadastro" className="text-indigo-800 hover:underline">
                            Cadastre-se
                        </Link>
                    </p>
                </form>
                <div className="fundoLogin hidden lg:block"></div>
            </div>
        </>
    );
}

export default Login;

```

**Vamos analisar as altera√ß√µes realizadas no c√≥digo:**

<div align="center"><img src="https://i.imgur.com/X17h82Q.png" title="source: imgur.com" /></div>

**Linhas 01 a 06:** Importamos os Componentes, Interfaces e Fun√ß√µes necess√°rias para a constru√ß√£o do Componente.

**Linha 10:** Criamos uma constante chamada **navigate** e atribu√≠mos o **Hook useNavigate()**. Atrav√©s da constante **navigate, o usu√°rio ser√° redirecionado para outras rotas da aplica√ß√£o, conforme a necessidade.**

**Linha 12:** Criamos uma desestrutura√ß√£o para receber os estados **usuario** e **isLoading**, al√©m da fun√ß√£o **handleLogin()**, dispon√≠veis na Context **AuthContext**, **atrav√©s do Hook useContext()**. 

**Linhas 14 a 16**: Criamos um Estado chamado **usuarioLogin**, que ser√° inicializado como um objeto vazio do tipo **UsuarioLogin** (Interface Model), atrav√©s do operador **as**, que **declara explicitamente ao TypeScript que o objeto vazio ser√° do tipo informado (UsuarioLogin).** 

O Estado **usuarioLogin**, ser√° utilizado para armazenar os dados do usu√°rio, que foram digitados no Formul√°rio da P√°gina de Login. 

**Linhas 18 a 22:** Adicionamos o **Hook useEffect**, que **ser√° executado sempre que houver uma mudan√ßa no Estado do usu√°rio autenticado, ou seja, o Estado usuario, que est√° armazenado na Context, que cont√©m os dados do usu√°rio autenticado**. 

Todas as vezes que ocorrer uma mudan√ßa no Estado **usuario**, **o La√ßo Condicional verificar√° se o token do usu√°rio n√£o est√° vazio. Se o token n√£o estiver vazio, significa que o usu√°rio est√° autenticado,** desta forma, a constante **navigate** ser√° invocada para redirecionar o usu√°rio para a rota do componente **Home** (/home).

**Linhas 24 a 29:** A fun√ß√£o **atualizarEstado** √© utilizada para atualizar dinamicamente os dados dos atributos do Estado **usuarioLogin**, que ser√° enviado para a  autentica√ß√£o do usu√°rio no Backend. 

Quando um elemento input do Formul√°rio for modificado, ou seja, o usu√°rio digitar alguma coisa no input, esta fun√ß√£o criar√° um novo objeto **usuarioLogin**, mantendo todos os valores armazenados anteriormente, atrav√©s do **Operador Spread**. Al√©m disso, o atributo associado ao input, que teve o seu valor alterado, ser√° atualizado com o novo valor digitado pelo usu√°rio.

`[e.target.name]` ü°™ *Propriedade name do input que foi modificado*

`e.target.value` ü°™ *Valor atual digitado dentro do input.*

Como as propriedades **name** de todos os inputs, possuem os mesmos nomes dos atributos definidos no Estado usuarioLogin, o valor do input que foi modificado, ser√° atribu√≠do ao respectivo atributo do Estado **usuarioLogin**.

**Linha 24:** Criamos a assinatura da fun√ß√£o **atualizarEstado()**, definindo um argumento, denominado **e** (Evento), do tipo **ChangeEvent<HTMLInputElement>**. Isso significa que a fun√ß√£o **atualizarEstado()** ter√° a responsabilidade de lidar com os eventos de mudan√ßa nos valores dos elementos **input**. Em outras palavras, todas as vezes que um input tiver seu conte√∫do alterado, a fun√ß√£o **atualizarEstado()** ser√° executada, atualizando o Estado **usuarioLogin**.

A fun√ß√£o **atualizarEstado()** ser√° associada ao evento **onChange** de todos os inputs do formul√°rio.

**Linha 25:** Chamamos a fun√ß√£o **setUsuarioLogin** para atualizar o Estado usuarioLogin. 

**Linha 26:** Para simplificar o nosso trabalho, utilizamos o **Operador Spread, caracterizado pelo uso dos 3 pontos antes do objeto usuarioLogin**. Dentro da fun√ß√£o, estamos criando um novo objeto usuarioLogin, mantendo todos os valores previamente armazenados. Ao mesmo tempo, atualizaremos o atributo associado ao input, cujo valor foi modificado. 

**Linha 27:** Nesta linha criamos uma atualiza√ß√£o din√¢mica no objeto resultante, que nos permite atualizar dinamicamente os valores dos atributos do Estado usuarioLogin, correspondente ao input que disparou o evento **onChange**. O nome do atributo que ser√° atualizado √© definido com o valor da propriedade **e.target.name** (nome do input, que sofreu a modifica√ß√£o), que corresponde ao atributo **name** do elemento **input**. O novo valor do atributo √© definido como o valor da propriedade **e.target.value**, que √© o valor atual do input que disparou o evento de mudan√ßa.

**Linhas 31 a 34:** A fun√ß√£o **login(e: FormEvent<HTMLFormElement>)** ser√° respons√°vel por lidar com o processo de autentica√ß√£o do usu√°rio (login), que ser√° executada atrav√©s do evento **onSubmit** do Formul√°rio da P√°gina de Login. 

**Linha 32:** A fun√ß√£o `e.preventDefault()` impede o comportamento padr√£o de recarregar a p√°gina. 

**Linha 33:** Chama a fun√ß√£o **handleLogin()**, disponibilizada pela Context, que √© respons√°vel pelo processo de autentica√ß√£o do usu√°rio. Observe que a fun√ß√£o **handleLogin()** recebe como par√¢metro o objeto **usuarioLogin**. 

<div align="center"><img src="https://i.imgur.com/xbc8hnM.png" title="source: imgur.com" /></div>

**Linha 41:** Adicionamos o **Evento onSubmit** no formul√°rio, passando como argumento a fun√ß√£o **login**, ou seja, quando o usu√°rio enviar o formul√°rio (clicar no bot√£o entrar), a fun√ß√£o definida dentro dos par√™nteses ser√° executada.

**Linhas 51 e 63:** Atrav√©s da propriedade `value`, definimos que o valor dentro desse input ser√° o mesmo valor que estiver armazenado no respectivo atributo do Estado **usuarioLogin**. 

**Linha 52 e 64:** Atrav√©s do evento **onChange** definiremos a fun√ß√£o que ser√° executada, todas as vezes que o valor do input for modificado, ou seja, quando o usu√°rio digitar alguma coisa no input. 

A fun√ß√£o **(e: ChangeEvent<HTMLInputElement>) => atualizarEstado(e)**, receber√° os dados do input que foi modificado, atrav√©s do par√¢metro **e** (Evento).

<div align="center"><img src="https://i.imgur.com/v8V0pZ8.png" title="source: imgur.com" /></div>

**Linhas 72 a 80:** Atrav√©s de uma **Express√£o Tern√°ria**, verificaremos qual √© o valor atual do Estado **isLoading**, para definir se o Componente loader **RotatingLines** ser√° exibido ou n√£o, indicando se existe um processo que est√° em andamento, ou seja, se o processo de autentica√ß√£o (login) do usu√°rio foi ou n√£o conclu√≠do. 

- Se o Estado **isLoading** estiver com o valor `false`, ser√° exibido no bot√£o o texto **Entrar**. 

- Se o Estado **isLoading** estiver com o valor `true`, ser√° exibido no bot√£o o Componente loader **RotatingLines**. 

O Componente loader **RotatingLines** faz parte da Biblioteca **React Loader Spinner**

<br />

<h2><img src="https://i.imgur.com/H9wEgsJ.png" title="source: imgur.com" width="4%"/>Passo 02 - Atualizar o Componente Navbar</h2>



Vamos criar um link no Componente **Navbar**, atrav√©s do Componente <Link />, da Biblioteca **React Router Dom**, para efetuar o logout da aplica√ß√£o ao clicar na op√ß√£o **Sair**:

1. Abra o Componente Navbar localizado dentro da pasta **src/components/navbar**
2. Substitua o C√≥digo do Componente **Navbar** pelo c√≥digo abaixo:

```tsx
import { useContext } from "react";
import { Link, useNavigate } from "react-router-dom"
import { AuthContext } from "../../contexts/AuthContext";

function Navbar() {

    const navigate = useNavigate();

    const { handleLogout } = useContext(AuthContext)

    function logout() {

        handleLogout()
        alert('O Usu√°rio foi desconectado com sucesso!')
        navigate('/')
    }
    
    return (
        <>
            <div className='w-full bg-indigo-900 text-white
                flex justify-center py-4'>

                <div className="container flex justify-between text-lg">
                    <Link to='/home' className="text-2xl font-bold">Blog Pessoal</Link>

                    <div className='flex gap-4'>
                        Postagens
                        Temas
                        Cadastrar tema
                        Perfil
                        <Link to='' onClick={logout} className='hover:underline'>Sair</Link>
                    </div>
                </div>
            </div>
        </>
    )
}

export default Navbar
```

**Vamos analisar as altera√ß√µes realizadas no c√≥digo:**

<div align="center"><img src="https://i.imgur.com/R7ScLWS.png" title="source: imgur.com" /></div>

**Linhas 01 a 03:** Importamos os Componentes, Interfaces e Fun√ß√µes necess√°rias para a constru√ß√£o do Componente.

**Linha 07:** Cria a constante **navigate**, que receber√° o Hook **useNavigate()**. Atrav√©s da constante **navigate**, o usu√°rio ser√° redirecionado para outras rotas da aplica√ß√£o, conforme a necessidade.

**Linha 09:** Criamos uma desestrutura√ß√£o para receber a fun√ß√£o **handleLogout()**, dispon√≠vel na **Context AuthContext**, atrav√©s do **Hook useContext()**. 

**Linhas 11 a 16:** Criamos a fun√ß√£o **logout()**, que ser√° respons√°vel por efetuar o processo de logout do usu√°rio. A fun√ß√£o **logout()** executa a fun√ß√£o **handleLogout()** da Context **AuthContext**, respons√°vel por reiniciar os dados do usu√°rio no contexto da aplica√ß√£o, ou seja, retornando para o Estado inicial. Na sequ√™ncia, ser√° exibido um alerta para informar o usu√°rio que o logout foi efetuado com sucesso e redireciona o usu√°rio para a P√°gina de Login, atrav√©s da constante **navigate**. 

**Linha 32:** Envolvemos o texto **Sair** com o Componente **Link** e adicionamos a propriedade **onClick** para executar a fun√ß√£o **logout()**. Tamb√©m adicionamos a classe **hover:underline** do Tailwind, para criar o efeito de texto underline ao passar o mouse sobre o texto. 

<br />

<h2><img src="https://i.imgur.com/H9wEgsJ.png" title="source: imgur.com" width="4%"/>Passo 03 - Testar o Componente Login</h2>



1. Abra o Terminal do **VSCode**.
2. Execute o projeto atrav√©s do comando abaixo:

```
yarn dev
```

3. Pressione a combina√ß√£o de teclas **o + enter** do seu teclado para abrir o Projeto no Navegador.
4. Com o projeto aberto no seu Navegador, a P√°gina de **Login** ser√° exibida, como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/2CNlVz4.png" title="source: imgur.com" /></div>

5. Fa√ßa o login na aplica√ß√£o, informando o **Usu√°rio** e a **Senha**.
6. Ser√° exibida a mensagem abaixo, indicando que o login foi bem sucedido:

<div align="center"><img src="https://i.imgur.com/lSNPSo1.png" title="source: imgur.com" /></div>

7. Caso ocorra algum erro, ser√° exibida a mensagem abaixo:

<div align="center"><img src="https://i.imgur.com/QBO0oHW.png" title="source: imgur.com" /></div>

8. Depois de clicar no bot√£o **OK**, voc√™ ser√° redirecionado para a P√°gina **Home**:

<div align="center"><img src="https://i.imgur.com/aE8lJZ2.png" title="source: imgur.com" /></div>

9. Clique na op√ß√£o **Sair**, para efetuar **logout**:

<div align="center"><img src="https://i.imgur.com/8qXw8en.png" title="source: imgur.com" /></div>

10. Ser√° exibida a mensagem abaixo, indicando que o logout foi bem sucedido:

<div align="center"><img src="https://i.imgur.com/FdmXfBG.png" title="source: imgur.com" /></div>

11. Depois de clicar no bot√£o **OK**, voc√™ ser√° redirecionado para a P√°gina de **Login**:

<div align="center"><img src="https://i.imgur.com/2CNlVz4.png" title="source: imgur.com" /></div>

<br>

<div align="left"><img src="https://i.imgur.com/H9wEgsJ.png" title="source: imgur.com" width="4%"/> <a href="https://www.npmjs.com/package/react-loader-spinner" target="_blank"><b>React Loader Spinner</b></a></div>

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Operators/Spread_syntax" target="_blank"><b>Documenta√ß√£o: Spread Operator</b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="5%"/> <a href="https://github.com/rafaelq80/blogpessoal_react_2024/tree/11_L%C3%B3gica_Login" target="_blank"><b>C√≥digo fonte do projeto</b></a></div>

<br /><br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>
